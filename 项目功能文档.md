# æ™ºèƒ½è¡Œä¸ºæ£€æµ‹ç³»ç»Ÿ - é¡¹ç›®åŠŸèƒ½æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æ™ºèƒ½è¡Œä¸ºæ£€æµ‹ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºYOLOv8+SlowFastç®—æ³•çš„å®æ—¶è¡Œä¸ºè¯†åˆ«å¹³å°ï¼Œæ”¯æŒè§†é¢‘æ–‡ä»¶æ£€æµ‹å’Œå®æ—¶æ‘„åƒå¤´ç›‘æ§ï¼Œèƒ½å¤Ÿè¯†åˆ«å¤šç§äººä½“è¡Œä¸ºå¹¶è¿›è¡Œå¼‚å¸¸æŠ¥è­¦ã€‚

### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
- **è§†é¢‘æ–‡ä»¶æ£€æµ‹**: æ”¯æŒå¤šç§æ ¼å¼è§†é¢‘ä¸Šä¼ å’Œæ‰¹é‡å¤„ç†
- **å®æ—¶ç›‘æ§**: å¤šè·¯æ‘„åƒå¤´åŒæ—¶ç›‘æ§ï¼Œå®æ—¶è¡Œä¸ºè¯†åˆ«
- **æ™ºèƒ½æŠ¥è­¦**: è‡ªåŠ¨è¯†åˆ«å¼‚å¸¸è¡Œä¸ºå¹¶åŠæ—¶æŠ¥è­¦
- **æ•°æ®åˆ†æ**: ä¸°å¯Œçš„ç»Ÿè®¡å›¾è¡¨å’Œå¯è§†åŒ–å±•ç¤º
- **Webç•Œé¢**: ç¾è§‚æ˜“ç”¨çš„ç®¡ç†ç•Œé¢
- **ç›®æ ‡è·Ÿè¸ª**: DeepSortç®—æ³•å®ç°ç²¾å‡†ç›®æ ‡è·Ÿè¸ª
- **å®æ—¶é€šä¿¡**: WebSocketå®ç°å®æ—¶æ•°æ®æ¨é€

### ğŸ§  æ£€æµ‹èƒ½åŠ›
ç³»ç»Ÿå¯ä»¥è¯†åˆ«ä»¥ä¸‹äººä½“è¡Œä¸ºï¼š
- ğŸš¶â€â™‚ï¸ æ­£å¸¸è¡Œèµ° (walk)
- ğŸƒâ€â™‚ï¸ å¥”è·‘ (run) - ä½çº§åˆ«æŠ¥è­¦
- ğŸ¤¸â€â™‚ï¸ è·Œå€’ (fall down) - **é«˜çº§åˆ«æŠ¥è­¦**
- ğŸ‘Š æ‰“æ–— (fight) - **é«˜çº§åˆ«æŠ¥è­¦**
- ğŸšª è¿›å…¥/ç¦»å¼€ (enter/exit) - ä¸­çº§åˆ«æŠ¥è­¦
- ğŸª‘ åä¸‹/ç«™ç«‹ (sit/stand)

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **åç«¯**: Flask + SQLite + WebSocket
- **å‰ç«¯**: Vue.js 3 + Element Plus + ECharts
- **ç®—æ³•**: YOLOv8 + SlowFast + DeepSort
- **æ•°æ®åº“**: SQLite
- **å®æ—¶é€šä¿¡**: Socket.IO

### é¡¹ç›®ç»“æ„
```
behavior_identify/
â”œâ”€â”€ backend/                  # åç«¯Flaskåº”ç”¨
â”‚   â”œâ”€â”€ app.py               # ä¸»åº”ç”¨æ–‡ä»¶
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ database.py      # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ detection_service.py      # æ£€æµ‹æœåŠ¡
â”‚   â”‚   â””â”€â”€ realtime_statistics.py   # å®æ—¶ç»Ÿè®¡
â”‚   â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ file_utils.py    # æ–‡ä»¶å¤„ç†å·¥å…·
â”‚   â”‚   â””â”€â”€ logger.py        # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ uploads/             # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ outputs/             # è¾“å‡ºæ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ requirements.txt     # Pythonä¾èµ–
â”œâ”€â”€ frontend/                # å‰ç«¯Vueåº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ views/           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ store/           # VuexçŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ styles/          # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ package.json         # Node.jsä¾èµ–
â”œâ”€â”€ yolo_slowfast-master/    # æ ¸å¿ƒç®—æ³•æ¨¡å—
â”‚   â”œâ”€â”€ yolo_slowfast.py     # ä¸»ç®—æ³•æ–‡ä»¶
â”‚   â”œâ”€â”€ deep_sort/           # ç›®æ ‡è·Ÿè¸ªç®—æ³•
â”‚   â”œâ”€â”€ selfutils/           # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ requirements.txt     # ç®—æ³•ä¾èµ–
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## ğŸ–¥ï¸ å‰ç«¯åŠŸèƒ½æ¨¡å—

### 1. ç³»ç»Ÿæ¦‚è§ˆ (Dashboard.vue)
- **åŠŸèƒ½**: ç³»ç»ŸçŠ¶æ€æ€»è§ˆï¼Œå®æ—¶ç»Ÿè®¡æ•°æ®å±•ç¤º
- **ç»„ä»¶**: ç»Ÿè®¡å¡ç‰‡ã€å›¾è¡¨å±•ç¤ºã€ç³»ç»ŸçŠ¶æ€ç›‘æ§
- **æ•°æ®**: æ´»è·ƒä»»åŠ¡æ•°ã€ä»Šæ—¥æŠ¥è­¦æ•°ã€æ€»æ£€æµ‹æ•°ã€ç³»ç»Ÿè¿è¡Œæ—¶é—´

### 2. è§†é¢‘ä¸Šä¼  (VideoUpload.vue)
- **åŠŸèƒ½**: è§†é¢‘æ–‡ä»¶ä¸Šä¼ å’Œæ£€æµ‹é…ç½®
- **æ”¯æŒæ ¼å¼**: MP4, AVI, MOV, WMVç­‰
- **é…ç½®é¡¹**: 
  - ç½®ä¿¡åº¦é˜ˆå€¼ (0.1-1.0)
  - è¾“å…¥å°ºå¯¸ (320/640/1280)
  - è®¾å¤‡ç±»å‹ (CPU/GPU)
  - æŠ¥è­¦è¡Œä¸ºé€‰æ‹©
- **æµç¨‹**: æ–‡ä»¶ä¸Šä¼  â†’ å‚æ•°é…ç½® â†’ å¯åŠ¨æ£€æµ‹ â†’ è¿›åº¦ç›‘æ§ â†’ ç»“æœæŸ¥çœ‹

### 3. å®æ—¶ç›‘æ§ (RealtimeMonitor.vue)
- **åŠŸèƒ½**: æ‘„åƒå¤´å®æ—¶ç›‘æ§å’Œè¡Œä¸ºæ£€æµ‹
- **ç‰¹æ€§**: 
  - å¤šæ‘„åƒå¤´æ”¯æŒ (0-9å·æ‘„åƒå¤´)
  - å®æ—¶è§†é¢‘æµæ˜¾ç¤º
  - å®æ—¶æ£€æµ‹ç»“æœå±•ç¤º
  - æŠ¥è­¦è¡Œä¸ºé…ç½®
  - ç»Ÿè®¡æ•°æ®å®æ—¶æ›´æ–°
- **æ§åˆ¶**: å¼€å§‹ç›‘æ§ã€åœæ­¢ç›‘æ§ã€å‚æ•°è°ƒæ•´

### 4. ä»»åŠ¡ç®¡ç† (TaskManager.vue)
- **åŠŸèƒ½**: æ£€æµ‹ä»»åŠ¡çš„ç®¡ç†å’Œç›‘æ§
- **æ“ä½œ**: æŸ¥çœ‹ä»»åŠ¡åˆ—è¡¨ã€ä»»åŠ¡è¯¦æƒ…ã€åˆ é™¤ä»»åŠ¡ã€ä¸‹è½½ç»“æœ
- **çŠ¶æ€**: pending(å¾…å¤„ç†)ã€running(è¿è¡Œä¸­)ã€completed(å·²å®Œæˆ)ã€failed(å¤±è´¥)
- **ç­›é€‰**: æŒ‰çŠ¶æ€ã€ç±»å‹ã€æ—¶é—´ç­›é€‰

### 5. æŠ¥è­¦è®°å½• (AlertRecords.vue)
- **åŠŸèƒ½**: å¼‚å¸¸è¡Œä¸ºæŠ¥è­¦çš„è®°å½•å’Œç®¡ç†
- **ä¿¡æ¯**: æŠ¥è­¦ç±»å‹ã€è§¦å‘æ—¶é—´ã€ç½®ä¿¡åº¦ã€å¤„ç†çŠ¶æ€
- **æ“ä½œ**: ç¡®è®¤æŠ¥è­¦ã€æ ‡è®°å·²å¤„ç†ã€æ·»åŠ å¤‡æ³¨
- **çŠ¶æ€**: active(æ´»è·ƒ)ã€acknowledged(å·²ç¡®è®¤)ã€resolved(å·²è§£å†³)

### 6. æ•°æ®ç»Ÿè®¡ (Statistics.vue)
- **åŠŸèƒ½**: ç³»ç»Ÿæ•°æ®çš„ç»Ÿè®¡åˆ†æå’Œå¯è§†åŒ–
- **å›¾è¡¨ç±»å‹**:
  - è¡Œä¸ºåˆ†å¸ƒé¥¼å›¾
  - æ—¶é—´è¶‹åŠ¿æŠ˜çº¿å›¾
  - æŠ¥è­¦çº§åˆ«åˆ†å¸ƒ
  - 24å°æ—¶æ—¶æ®µåˆ†æ
- **æ—¶é—´èŒƒå›´**: 24å°æ—¶ã€7å¤©ã€30å¤©ã€90å¤©ã€è‡ªå®šä¹‰
- **å¯¼å‡º**: æ”¯æŒCSVæ ¼å¼æ•°æ®å¯¼å‡º

### 7. ç³»ç»Ÿè®¾ç½® (Settings.vue)
- **åŠŸèƒ½**: ç³»ç»Ÿå‚æ•°é…ç½®å’Œç®¡ç†
- **é…ç½®é¡¹**: æ£€æµ‹å‚æ•°ã€æŠ¥è­¦è®¾ç½®ã€ç³»ç»Ÿé…ç½®
- **ç®¡ç†**: ç”¨æˆ·ç®¡ç†ã€æƒé™è®¾ç½®ã€æ—¥å¿—æŸ¥çœ‹

## ğŸ”§ åç«¯APIæ¥å£

### 1. ç³»ç»Ÿæ¥å£
- `GET /` - ç³»ç»Ÿé¦–é¡µä¿¡æ¯
- `GET /api/health` - å¥åº·æ£€æŸ¥
- `GET /api/system/uptime` - ç³»ç»Ÿè¿è¡Œæ—¶é—´

### 2. æ–‡ä»¶ä¸Šä¼ æ¥å£
- `POST /api/upload` - è§†é¢‘æ–‡ä»¶ä¸Šä¼ 
  - å‚æ•°: video(æ–‡ä»¶), task_name, confidence, input_size, device
  - è¿”å›: taskId, filename, file_path

### 3. æ£€æµ‹æ§åˆ¶æ¥å£
- `POST /api/detect/video` - å¯åŠ¨è§†é¢‘æ£€æµ‹
- `POST /api/detect/realtime` - å¯åŠ¨å®æ—¶æ£€æµ‹
- `POST /api/detect/stop/<task_id>` - åœæ­¢æ£€æµ‹ä»»åŠ¡
- `POST /api/stop_monitoring` - åœæ­¢å®æ—¶ç›‘æ§

### 4. è§†é¢‘æµæ¥å£
- `GET /api/realtime_feed` - å®æ—¶æ£€æµ‹è§†é¢‘æµ
- `GET /video_feed` - è§†é¢‘æµ(å…¼å®¹æ¥å£)
  - å‚æ•°: source, device, input_size, confidence, preview_only, alert_behaviors

### 5. æ•°æ®æŸ¥è¯¢æ¥å£
- `GET /api/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
  - å‚æ•°: page, per_page, status, type
- `GET /api/tasks/<task_id>` - è·å–ä»»åŠ¡è¯¦æƒ…
- `GET /api/tasks/<task_id>/results` - è·å–ä»»åŠ¡å®Œæ•´ç»“æœ
- `DELETE /api/tasks/<task_id>` - åˆ é™¤ä»»åŠ¡

### 6. æŠ¥è­¦ç®¡ç†æ¥å£
- `GET /api/alerts` - è·å–æŠ¥è­¦è®°å½•
- `POST /api/alerts/<alert_id>/status` - æ›´æ–°æŠ¥è­¦çŠ¶æ€

### 7. ç»Ÿè®¡åˆ†ææ¥å£
- `GET /api/statistics` - è·å–åŸºç¡€ç»Ÿè®¡ä¿¡æ¯
- `GET /api/statistics/overview` - è·å–æ¦‚è§ˆç»Ÿè®¡
- `GET /api/statistics/charts` - è·å–å›¾è¡¨æ•°æ®
- `GET /api/statistics/export` - å¯¼å‡ºç»Ÿè®¡æ•°æ®

### 8. æ–‡ä»¶æœåŠ¡æ¥å£
- `GET /api/download/result/<task_id>` - ä¸‹è½½æ£€æµ‹ç»“æœ
- `GET /api/outputs/<filename>` - é™æ€æ–‡ä»¶è®¿é—®(æ”¯æŒRangeè¯·æ±‚)

### 9. WebSocketæ¥å£
- å‘½åç©ºé—´: `/detection`
- äº‹ä»¶:
  - `progress_update` - è¿›åº¦æ›´æ–°
  - `task_completed` - ä»»åŠ¡å®Œæˆ
  - `task_failed` - ä»»åŠ¡å¤±è´¥
  - `realtime_result` - å®æ—¶æ£€æµ‹ç»“æœ

## ğŸ¤– æ ¸å¿ƒç®—æ³•æ¨¡å—

### YOLOv8ç›®æ ‡æ£€æµ‹
- **æ¨¡å‹**: yolov8n.pt (è½»é‡çº§ç‰ˆæœ¬)
- **åŠŸèƒ½**: äººä½“ç›®æ ‡æ£€æµ‹å’Œå®šä½
- **è¾“å‡º**: è¾¹ç•Œæ¡†åæ ‡ã€ç½®ä¿¡åº¦ã€ç±»åˆ«

### SlowFastè¡Œä¸ºè¯†åˆ«
- **æ¨¡å‹**: SLOWFAST_8x8_R50_DETECTION.pyth
- **åŠŸèƒ½**: åŸºäºè§†é¢‘åºåˆ—çš„è¡Œä¸ºåˆ†ç±»
- **æ”¯æŒè¡Œä¸º**: 80ç§AVAæ•°æ®é›†è¡Œä¸ºç±»åˆ«

### DeepSortç›®æ ‡è·Ÿè¸ª
- **æ¨¡å‹**: ckpt.t7
- **åŠŸèƒ½**: å¤šç›®æ ‡è·Ÿè¸ªï¼Œä¸ºæ¯ä¸ªæ£€æµ‹å¯¹è±¡åˆ†é…å”¯ä¸€ID
- **ç‰¹æ€§**: å¤„ç†é®æŒ¡ã€é‡æ–°è¯†åˆ«

### é›†æˆæµç¨‹
1. **è§†é¢‘è¾“å…¥** â†’ YOLOv8æ£€æµ‹äººä½“ç›®æ ‡
2. **ç›®æ ‡æ¡†** â†’ DeepSortåˆ†é…è·Ÿè¸ªID
3. **è§†é¢‘åºåˆ—** â†’ SlowFastè¯†åˆ«è¡Œä¸ºç±»å‹
4. **ç»“æœèåˆ** â†’ è¾“å‡ºæœ€ç»ˆæ£€æµ‹ç»“æœ

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### 1. æ£€æµ‹ä»»åŠ¡è¡¨ (detection_tasks)
```sql
- id: ä¸»é”®
- task_name: ä»»åŠ¡åç§°
- source_type: æºç±»å‹(video/camera)
- source_path: æºè·¯å¾„
- output_path: è¾“å‡ºè·¯å¾„
- status: çŠ¶æ€(pending/running/completed/failed)
- progress: è¿›åº¦(0-100)
- created_at/started_at/completed_at: æ—¶é—´æˆ³
- confidence_threshold: ç½®ä¿¡åº¦é˜ˆå€¼
- input_size: è¾“å…¥å°ºå¯¸
- device: è®¾å¤‡ç±»å‹
- total_frames/processed_frames: å¸§æ•°ç»Ÿè®¡
- detected_objects/detected_behaviors: æ£€æµ‹ç»Ÿè®¡
```

### 2. æ£€æµ‹ç»“æœè¡¨ (detection_results)
```sql
- id: ä¸»é”®
- task_id: å…³è”ä»»åŠ¡ID
- frame_number: å¸§å·
- timestamp: æ—¶é—´æˆ³
- object_id: ç›®æ ‡è·Ÿè¸ªID
- object_type: ç›®æ ‡ç±»å‹
- confidence: æ£€æµ‹ç½®ä¿¡åº¦
- bbox_x1/y1/x2/y2: è¾¹ç•Œæ¡†åæ ‡
- behavior_type: è¡Œä¸ºç±»å‹
- behavior_confidence: è¡Œä¸ºç½®ä¿¡åº¦
- is_anomaly: æ˜¯å¦å¼‚å¸¸è¡Œä¸º
- velocity_x/y: é€Ÿåº¦ä¿¡æ¯
```

### 3. æŠ¥è­¦è®°å½•è¡¨ (alert_records)
```sql
- id: ä¸»é”®
- task_id: å…³è”ä»»åŠ¡ID
- alert_type: æŠ¥è­¦ç±»å‹
- status: å¤„ç†çŠ¶æ€(active/acknowledged/resolved)
- trigger_frame: è§¦å‘å¸§å·
- trigger_timestamp: è§¦å‘æ—¶é—´
- trigger_object_id: è§¦å‘ç›®æ ‡ID
- trigger_behavior: è§¦å‘è¡Œä¸º
- trigger_confidence: è§¦å‘ç½®ä¿¡åº¦
- description: æè¿°ä¿¡æ¯
- acknowledged_at/by: ç¡®è®¤ä¿¡æ¯
- resolved_at: è§£å†³æ—¶é—´
- note: å¤‡æ³¨
```

### 4. ç³»ç»Ÿé…ç½®è¡¨ (system_configs)
```sql
- id: ä¸»é”®
- config_key: é…ç½®é”®
- config_value: é…ç½®å€¼
- config_type: é…ç½®ç±»å‹
- description: æè¿°
- created_at/updated_at: æ—¶é—´æˆ³
```

### 5. ç³»ç»Ÿæ—¥å¿—è¡¨ (system_logs)
```sql
- id: ä¸»é”®
- level: æ—¥å¿—çº§åˆ«
- message: æ—¥å¿—æ¶ˆæ¯
- module: æ¨¡å—åç§°
- function: å‡½æ•°åç§°
- line_number: è¡Œå·
- created_at: åˆ›å»ºæ—¶é—´
```

## ğŸš€ éƒ¨ç½²å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Node.js 16+
- CUDA (å¯é€‰ï¼Œç”¨äºGPUåŠ é€Ÿ)

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**
```bash
git clone [repository-url]
cd behavior_identify
```

2. **åç«¯ç¯å¢ƒ**
```bash
cd backend
pip install -r requirements.txt
```

3. **å‰ç«¯ç¯å¢ƒ**
```bash
cd frontend
npm install
```

4. **ç®—æ³•ä¾èµ–**
```bash
cd yolo_slowfast-master
pip install -r requirements.txt
```

### å¯åŠ¨æœåŠ¡

1. **å¯åŠ¨åç«¯**
```bash
cd backend
python app.py
```
- æœåŠ¡åœ°å€: http://localhost:5000
- WebSocket: ws://localhost:5000/detection

2. **å¯åŠ¨å‰ç«¯**
```bash
cd frontend
npm run serve
```
- è®¿é—®åœ°å€: http://localhost:8080

### é…ç½®è¯´æ˜

1. **åç«¯é…ç½®** (backend/config/config.py)
- æ•°æ®åº“è¿æ¥
- æ–‡ä»¶ä¸Šä¼ è·¯å¾„
- æ—¥å¿—é…ç½®
- WebSocketé…ç½®

2. **å‰ç«¯é…ç½®** (frontend/vue.config.js)
- APIä»£ç†é…ç½®
- æ„å»ºé…ç½®
- å¼€å‘æœåŠ¡å™¨é…ç½®

3. **ç®—æ³•é…ç½®**
- æ¨¡å‹æ–‡ä»¶è·¯å¾„
- è®¾å¤‡é€‰æ‹©(CPU/GPU)
- æ£€æµ‹å‚æ•°

## ğŸ“ å¼€å‘è¯´æ˜

### ä»£ç è§„èŒƒ
- åç«¯: PEP 8 Pythonä»£ç è§„èŒƒ
- å‰ç«¯: Vue.jså®˜æ–¹é£æ ¼æŒ‡å—
- æ³¨é‡Š: ä¸­æ–‡æ³¨é‡Šï¼Œè¯¦ç»†è¯´æ˜åŠŸèƒ½

### æ‰©å±•æŒ‡å—
1. **æ·»åŠ æ–°çš„è¡Œä¸ºç±»å‹**: ä¿®æ”¹AVAæ ‡ç­¾æ–‡ä»¶å’Œå‰ç«¯é…ç½®
2. **é›†æˆæ–°ç®—æ³•**: åœ¨detection_service.pyä¸­æ·»åŠ æ–°çš„æ£€æµ‹æ–¹æ³•
3. **æ‰©å±•API**: åœ¨app.pyä¸­æ·»åŠ æ–°çš„è·¯ç”±å’Œå¤„ç†å‡½æ•°
4. **å‰ç«¯åŠŸèƒ½**: åœ¨viewsç›®å½•ä¸‹æ·»åŠ æ–°çš„Vueç»„ä»¶

### è°ƒè¯•æŠ€å·§
1. **åç«¯è°ƒè¯•**: æŸ¥çœ‹logs/app.logæ—¥å¿—æ–‡ä»¶
2. **å‰ç«¯è°ƒè¯•**: ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·
3. **ç®—æ³•è°ƒè¯•**: å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡º
4. **WebSocketè°ƒè¯•**: ä½¿ç”¨Socket.IOè°ƒè¯•å·¥å…·

---

*æ–‡æ¡£ç‰ˆæœ¬: v1.0*  
*æœ€åæ›´æ–°: 2025-01-04*
